# ğŸ“– ä½¿ç”¨ç¤ºä¾‹

## å¯¹è¯ç¤ºä¾‹

### 1. å¤©æ°”æŸ¥è¯¢

**ç”¨æˆ·è¾“å…¥ï¼š**
```
åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
```

**AIå›å¤ï¼š**
```
åŒ—äº¬å½“å‰å¤©æ°”ï¼šæ™´ï¼Œæ°”æ¸©15Â°Cï¼ˆä½“æ„Ÿ13Â°Cï¼‰ï¼Œæ¹¿åº¦45%ï¼Œé£é€Ÿ12km/hã€‚
ä»Šæ—¥æ¸©åº¦èŒƒå›´ï¼š8Â°C ~ 18Â°C

ä»Šå¤©åŒ—äº¬å¤©æ°”ä¸é”™ï¼Œé€‚åˆå¤–å‡ºæ—…è¡Œã€‚æ¸©åº¦é€‚ä¸­ï¼Œå»ºè®®ç©¿é•¿è¢–è¡£ç‰©ã€‚
```

---

### 2. æ™¯ç‚¹æ¨è

**ç”¨æˆ·è¾“å…¥ï¼š**
```
ä¸Šæµ·æœ‰ä»€ä¹ˆå¥½ç©çš„æ™¯ç‚¹æ¨èï¼Ÿ
```

**AIå›å¤ï¼š**
```
ä¸Šæµ·æ¨èæ™¯ç‚¹ï¼šå¤–æ»©é£æ™¯åŒºï¼Œè¯¥æ™¯ç‚¹ä½äºé»„æµ¦åŒºä¸­å±±ä¸œä¸€è·¯ï¼Œ
è¯¥æ™¯ç‚¹çš„è¯„åˆ†ï¼š4.7ï¼Œæ¨èå‰å¾€æ—¶é—´ï¼šå…¨å¤©å¼€æ”¾

å¤–æ»©æ˜¯ä¸Šæµ·çš„æ ‡å¿—æ€§æ™¯ç‚¹ä¹‹ä¸€ï¼Œå¯ä»¥æ¬£èµé»„æµ¦æ±Ÿä¸¤å²¸çš„ç¾æ™¯ï¼Œ
å°¤å…¶æ˜¯å¤œæ™šç¯å…‰ç’€ç’¨ï¼Œéå¸¸é€‚åˆæ‹ç…§ç•™å¿µã€‚
```

---

### 3. ç»¼åˆå’¨è¯¢

**ç”¨æˆ·è¾“å…¥ï¼š**
```
æˆ‘æƒ³ä¸‹å‘¨å»æ­å·æ—…è¡Œï¼Œå¸®æˆ‘çœ‹çœ‹å¤©æ°”å¹¶æ¨èæ™¯ç‚¹
```

**AIå›å¤ï¼š**
```
è®©æˆ‘ä¸ºæ‚¨æŸ¥è¯¢æ­å·çš„å¤©æ°”å’Œæ™¯ç‚¹ä¿¡æ¯ã€‚

ã€å¤©æ°”æƒ…å†µã€‘
æ­å·å½“å‰å¤©æ°”ï¼šå¤šäº‘ï¼Œæ°”æ¸©22Â°Cï¼ˆä½“æ„Ÿ21Â°Cï¼‰ï¼Œæ¹¿åº¦65%ï¼Œé£é€Ÿ8km/hã€‚
ä»Šæ—¥æ¸©åº¦èŒƒå›´ï¼š18Â°C ~ 25Â°C

ã€æ™¯ç‚¹æ¨èã€‘
æ­å·æ¨èæ™¯ç‚¹ï¼šè¥¿æ¹–é£æ™¯åèƒœåŒºï¼Œè¯¥æ™¯ç‚¹ä½äºè¥¿æ¹–åŒºé¾™äº•è·¯1å·ï¼Œ
è¯¥æ™¯ç‚¹çš„è¯„åˆ†ï¼š4.8ï¼Œæ¨èå‰å¾€æ—¶é—´ï¼šå…¨å¤©å¼€æ”¾

ã€æ—…è¡Œå»ºè®®ã€‘
æ­å·ç°åœ¨å¤©æ°”å®œäººï¼Œéå¸¸é€‚åˆæ—…æ¸¸ã€‚è¥¿æ¹–æ˜¯å¿…æ¸¸æ™¯ç‚¹ï¼Œå»ºè®®æ‚¨ï¼š
1. æ—©æ™¨æˆ–å‚æ™šæ¸¸è§ˆè¥¿æ¹–ï¼Œå…‰çº¿æŸ”å’Œé€‚åˆæ‹ç…§
2. å¯ä»¥ç§Ÿç”¨å…±äº«å•è½¦ç¯æ¹–éª‘è¡Œ
3. å¸¦ä¸Šé›¨å…·ï¼Œæ­å·å¤©æ°”å¤šå˜
4. å“å°å½“åœ°ç‰¹è‰²ç¾é£Ÿå¦‚é¾™äº•è™¾ä»ã€å«åŒ–é¸¡
```

---

### 4. å¤šè½®å¯¹è¯ï¼ˆä¸Šä¸‹æ–‡è®°å¿†ï¼‰

**ç¬¬ä¸€è½®ï¼š**
```
ç”¨æˆ·: æŸ¥ä¸€ä¸‹æˆéƒ½çš„å¤©æ°”
AI: æˆéƒ½å½“å‰å¤©æ°”ï¼šé˜´ï¼Œæ°”æ¸©18Â°Cï¼Œæ¹¿åº¦78%...
```

**ç¬¬äºŒè½®ï¼š**
```
ç”¨æˆ·: é‚£è¾¹æœ‰ä»€ä¹ˆå¥½åƒçš„ï¼Ÿ
AI: æˆéƒ½æ˜¯è‘—åçš„ç¾é£Ÿä¹‹éƒ½ï¼Œæ¨èæ‚¨å“å°ï¼š
    1. ç«é”… - å·å‘³ç«é”…äº«èª‰å…¨å›½
    2. ä¸²ä¸²é¦™ - æˆéƒ½ç‰¹è‰²å°åƒ
    3. æ‹…æ‹…é¢ã€é¾™æŠ„æ‰‹ç­‰ä¼ ç»Ÿå°åƒ
    ...
```

**ç¬¬ä¸‰è½®ï¼š**
```
ç”¨æˆ·: æ™¯ç‚¹å‘¢ï¼Ÿ
AI: æˆéƒ½æ¨èæ™¯ç‚¹ï¼šå®½çª„å··å­ï¼Œä½äºé’ç¾ŠåŒº...
```

---

## APIè°ƒç”¨ç¤ºä¾‹

### Pythonç¤ºä¾‹

```python
import requests

# 1. ç®€å•å¯¹è¯
def chat(message, conversation_id="default"):
    response = requests.post(
        "http://localhost:8000/chat",
        json={
            "message": message,
            "conversation_id": conversation_id
        }
    )
    return response.json()

# ä½¿ç”¨ç¤ºä¾‹
result = chat("åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ", "user-123")
print(result['message'])

# 2. åˆ›å»ºæ–°å¯¹è¯
def new_conversation(conv_id):
    response = requests.post(
        f"http://localhost:8000/new-conversation?conversation_id={conv_id}"
    )
    return response.json()

new_conversation("user-456")

# 3. æŸ¥çœ‹æ‰€æœ‰å¯¹è¯
def list_conversations():
    response = requests.get("http://localhost:8000/conversations")
    return response.json()

conversations = list_conversations()
print(f"æ´»è·ƒå¯¹è¯æ•°: {conversations['count']}")
```

### JavaScriptç¤ºä¾‹

```javascript
// 1. å‘é€èŠå¤©æ¶ˆæ¯
async function chat(message, conversationId = "default") {
    const response = await fetch('http://localhost:8000/chat', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            message: message,
            conversation_id: conversationId
        })
    });
    
    const data = await response.json();
    return data;
}

// ä½¿ç”¨ç¤ºä¾‹
chat("ä¸Šæµ·æœ‰ä»€ä¹ˆæ™¯ç‚¹ï¼Ÿ", "user-001")
    .then(result => {
        console.log(result.message);
        if (result.weather_data) {
            console.log("åŒ…å«å¤©æ°”æ•°æ®");
        }
    });

// 2. è·å–å¯¹è¯åˆ—è¡¨
async function getConversations() {
    const response = await fetch('http://localhost:8000/conversations');
    const data = await response.json();
    return data;
}

// 3. åˆ é™¤å¯¹è¯
async function deleteConversation(conversationId) {
    const response = await fetch(
        `http://localhost:8000/conversation/${conversationId}`,
        { method: 'DELETE' }
    );
    return await response.json();
}
```

### cURLç¤ºä¾‹

```bash
# 1. å¥åº·æ£€æŸ¥
curl http://localhost:8000/

# 2. å‘é€èŠå¤©æ¶ˆæ¯
curl -X POST "http://localhost:8000/chat" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ",
    "conversation_id": "test-001"
  }'

# 3. è·å–å¯¹è¯åˆ—è¡¨
curl http://localhost:8000/conversations

# 4. åˆ›å»ºæ–°å¯¹è¯
curl -X POST "http://localhost:8000/new-conversation?conversation_id=new-chat-001"

# 5. åˆ é™¤å¯¹è¯
curl -X DELETE "http://localhost:8000/conversation/test-001"
```

---

## å‰ç«¯é›†æˆç¤ºä¾‹

### åŸºç¡€èŠå¤©åŠŸèƒ½

```html
<!DOCTYPE html>
<html>
<head>
    <title>å¤©æ°”æ—…è¡ŒåŠ©æ‰‹</title>
</head>
<body>
    <div id="chat-container"></div>
    <input id="message-input" type="text" placeholder="è¾“å…¥æ¶ˆæ¯...">
    <button onclick="sendMessage()">å‘é€</button>

    <script>
        const conversationId = "user-" + Date.now();
        
        async function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            addMessage('user', message);
            input.value = '';
            
            try {
                // è°ƒç”¨API
                const response = await fetch('http://localhost:8000/chat', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        message: message,
                        conversation_id: conversationId
                    })
                });
                
                const data = await response.json();
                
                // æ˜¾ç¤ºAIå›å¤
                addMessage('ai', data.message);
                
            } catch (error) {
                console.error('é”™è¯¯:', error);
                addMessage('system', 'è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡');
            }
        }
        
        function addMessage(sender, text) {
            const container = document.getElementById('chat-container');
            const messageDiv = document.createElement('div');
            messageDiv.className = sender;
            messageDiv.textContent = text;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }
    </script>
</body>
</html>
```

---

## é«˜çº§åŠŸèƒ½ç¤ºä¾‹

### 1. æµå¼å“åº”ï¼ˆæœªæ¥åŠŸèƒ½ï¼‰

```python
@app.post("/chat-stream")
async def chat_stream(request: ChatRequest):
    async def generate():
        # å®ç°æµå¼è¾“å‡º
        for chunk in agent.stream(messages):
            yield f"data: {json.dumps(chunk)}\n\n"
    
    return StreamingResponse(generate(), media_type="text/event-stream")
```

### 2. è‡ªå®šä¹‰å·¥å…·

```python
from langchain_core.tools import tool

@tool('get_hotel')
def get_hotel(city: str, budget: str) -> str:
    """æŸ¥è¯¢é…’åº—ä¿¡æ¯"""
    # å®ç°é…’åº—æŸ¥è¯¢é€»è¾‘
    return f"{city}çš„{budget}é…’åº—æ¨è..."

# æ·»åŠ åˆ°agent
agent = create_react_agent(
    llm,
    tools=[get_weather, get_introduction, get_hotel],
    ...
)
```

### 3. é”™è¯¯å¤„ç†

```python
@app.exception_handler(Exception)
async def global_exception_handler(request, exc):
    return JSONResponse(
        status_code=500,
        content={
            "type": "error",
            "message": "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯",
            "detail": str(exc)
        }
    )
```

---

## è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

### 2. æµ‹è¯•å•ä¸ªå·¥å…·

```python
from tools.get_weather import get_weather

result = get_weather("åŒ—äº¬", 0)
print(result)
```

### 3. æŸ¥çœ‹å¯¹è¯å†å²

```python
# åœ¨api_server.pyæ·»åŠ 
@app.get("/conversation/{conversation_id}/history")
async def get_history(conversation_id: str):
    config = conversations.get(conversation_id)
    if not config:
        raise HTTPException(404, "å¯¹è¯ä¸å­˜åœ¨")
    
    # è·å–å†å²è®°å½•
    history = memory.get_messages(config)
    return {"messages": history}
```

---

éœ€è¦æ›´å¤šå¸®åŠ©ï¼ŸæŸ¥çœ‹ [å®Œæ•´æ–‡æ¡£](README.md)

